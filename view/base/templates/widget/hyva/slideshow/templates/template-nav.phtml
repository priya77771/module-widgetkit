<?php

/**
 * @var Slideshow $this
 * @var Escaper $escaper
 */

use MageOS\Widgetkit\Block\Widgets\Slideshow;
use Magento\Framework\Escaper;

$params = $this->getData('params');
$navigation = $params['mageos_slideshow_navigation'];
$navigationPosition = [
    'class' => $this->resolveExpression([
        'absolute top-0 left-0 z-10 {@mageos_slideshow_navigation_position: top-left}',
        'absolute top-0 inset-x-0 z-10 {@mageos_slideshow_navigation_position: top-center}',
        'absolute top-0 right-0 z-10 {@mageos_slideshow_navigation_position: top-right}',
        'absolute inset-y-0 left-0 z-10 {@mageos_slideshow_navigation_position: center-left}',
        'absolute inset-y-0 right-0 z-10 {@mageos_slideshow_navigation_position: center-right}',
        'absolute bottom-0 left-0 z-10 {@mageos_slideshow_navigation_position: bottom-left}',
        'absolute bottom-0 inset-x-0 z-10 {@mageos_slideshow_navigation_position: bottom-center}',
        'absolute bottom-0 right-0 z-10 {@mageos_slideshow_navigation_position: bottom-right}',
        'justify-start {@mageos_slideshow_navigation_position: below-left}',
        'justify-center {@mageos_slideshow_navigation_position: below-center}',
        'justify-end {@mageos_slideshow_navigation_position: below-right}',
        'flex-row {@mageos_slideshow_navigation_direction: horizontal}',
        'flex-col {@mageos_slideshow_navigation_direction: vertical}',
        'hidden sm:flex {@mageos_slideshow_navigation_display: s}',
        'hidden md:flex {@mageos_slideshow_navigation_display: m}',
        'hidden lg:flex {@mageos_slideshow_navigation_display: l}',
        'hidden xl:flex {@mageos_slideshow_navigation_display: xl}'
    ], $params)
];
?>

<?php if($navigation === 'thumbnav'): ?>
<div
    x-cloak
    x-show="dotsNavigation"
    class="flex flex-wrap gap-3 cursor-pointer <?= $navigationPosition['class']; ?> py-4 px-2"
>
    <?php
    $thumbnavWidth = (int)$params['mageos_slideshow_navigation_thumbnav_width'] ?? 100;
    $thumbnavHeight = (int)$params['mageos_slideshow_navigation_thumbnav_height'] ?? 67;
    $index = 0;
    foreach ($this->getData('items') as $item):
        $image = [
            'src' => $item['navigation_thumb'] ?: $item['image'],
            'alt' => $item['image_alt'],
            'style' => $this->resolveExpression([
                'height: {0}; {@mageos_slideshow_navigation_thumbnav_height}' => $thumbnavHeight . 'px',
                'width: {0}; {@mageos_slideshow_navigation_thumbnav_width}' => $thumbnavWidth . 'px',
            ], $params)
        ];
        ?>
        <div style="<?= $image['style']; ?>"
             class="overflow-hidden"
             x-bind:class="{
                'ring-2': currentIndex === <?= $index ?>
            }">
            <img
                src="<?= $image['src']; ?>"
                alt="<?= $image['alt']; ?>"
                loading="eager"
                x-on:click="set(<?= $index ?>, 'button')"
                type="button"
                width="<?= $thumbnavWidth; ?>"
                height="<?= $thumbnavHeight; ?>"
                class="object-cover"
            />
        </div>
    <?php $index++; endforeach; ?>
</div>
<?php else: ?>
<div x-show="dotsNavigation" class="<?= $navigationPosition['class']; ?> px-2 snap-pager">
    <?php
        $index = 0;
        foreach ($this->getData('items') as $item):
    ?>
        <div
            x-on:click="set(<?= $index ?>, 'button')"
            class="snap-marker cursor-pointer"
            role="tab"
            x-bind:aria-current="currentIndex === <?= $index ?>"
            x-cloak
        >
            <span class="sr-only">
                <?= $escaper->escapeHtmlAttr(__('View more about %1', $item['title'])) ?>
            </span>
        </div>
    <?php $index++; endforeach; ?>
</div>
<?php endif; ?>
